<!DOCTYPE html>
<html lang="ml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKSSF QUIZ 2026</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #004d00; --gold: #f1c40f; --bg: #f2f5f8; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg); margin: 0; padding-bottom: 120px; color: #333; }
        .header { background: linear-gradient(135deg, #004d00, #002b00); color: white; text-align: center; padding: 60px 20px 90px; border-radius: 0 0 60px 60px; }
        .container { max-width: 500px; margin: 0 auto; padding: 0 15px; }
        .card { background: white; padding: 25px; border-radius: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); margin-bottom: 25px; border-top: 6px solid var(--gold); }
        .id-number { font-family: 'Orbitron', sans-serif; font-size: 40px; color: var(--primary); font-weight: 900; background: #f0fdf4; padding: 10px; border-radius: 15px; border: 2px dashed var(--gold); display: inline-block; }
        
        /* Public Winner Board */
        .public-winner-board { background: #fff; border: 3px solid var(--gold); border-radius: 25px; padding: 20px; text-align: center; margin-top: -40px; margin-bottom: 30px; display: none; }
        .public-winner-board h2 { color: var(--primary); margin-bottom: 10px; font-size: 20px; }
        
        input, select { width: 100%; padding: 16px; margin-bottom: 15px; border-radius: 12px; border: 1.5px solid #eee; }
        .btn { width: 100%; padding: 18px; border: none; border-radius: 15px; font-weight: 800; cursor: pointer; color: white; background: var(--primary); font-size: 15px; }
        .footer { position: fixed; bottom: 0; width: 100%; background: white; padding: 15px 0; text-align: center; border-top: 1px solid #eee; }
        canvas { width: 100%; border-radius: 15px; margin-top: 15px; border: 1px solid #ddd; display: none; }
    </style>
</head>
<body>

<div class="header">
    <h1 style="margin:0; font-size: 30px;">SAMASTHA ONLINE QUIZ</h1>
    <p style="color:var(--gold); font-weight:600; font-size: 13px;">SKSSF CHAPPARAPPADAV ZONE</p>
</div>

<div class="container">
    <div id="publicWinnerArea" class="public-winner-board">
        <h2>üéâ ‡¥µ‡¥ø‡¥ú‡¥Ø‡¥ø‡¥Ø‡µÜ ‡¥™‡µç‡¥∞‡¥ñ‡µç‡¥Ø‡¥æ‡¥™‡¥ø‡¥ö‡µç‡¥ö‡µÅ üéâ</h2>
        <div id="winnerPosterDisplay"></div>
        <canvas id="publicCanvas" width="800" height="1000"></canvas>
    </div>

    <div id="authSec">
        <div id="regSuccess" class="card" style="display:none; text-align:center; border-color:var(--primary);">
            <div style="font-weight:600;">‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥∞‡¥ú‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡µº ‡¥ï‡µã‡¥°‡µç</div>
            <div class="id-number" id="finalId">0000</div>
            <div style="font-size:12px; margin-top:10px;">‡¥≤‡µã‡¥ó‡¥ø‡µª ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥æ‡µª ‡¥à ‡¥®‡¥Æ‡µç‡¥™‡µº ‡¥â‡¥™‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï</div>
        </div>

        <div class="card" id="regForm">
            <h3 style="color: var(--primary); margin-top:0;">‡¥∞‡¥ú‡¥ø‡¥∏‡µç‡¥ü‡µç‡¥∞‡µá‡¥∑‡µª</h3>
            <input type="text" id="rName" placeholder="‡¥Æ‡µÅ‡¥¥‡µÅ‡¥µ‡µª ‡¥™‡µá‡¥∞‡µç">
            <input type="number" id="rMob" placeholder="‡¥Æ‡µä‡¥¨‡µà‡µΩ ‡¥®‡¥Æ‡µç‡¥™‡µº">
            <select id="rBranch">
                <option value="">‡¥∂‡¥æ‡¥ñ ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï</option>
                <option>KARUVANCHAL</option><option>VILAKKANNOOR</option><option>CHAPPARAPPADAV</option>
                <option>NADUVIL</option><option>PADAPPENGAD</option>
            </select>
            <button class="btn" onclick="registerUser()">REGISTER</button>
        </div>

        <div class="card">
            <h3 style="color: var(--primary); margin-top:0;">‡¥≤‡µã‡¥ó‡¥ø‡µª</h3>
            <input type="number" id="lId" placeholder="‡¥∞‡¥ú‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡µº ‡¥®‡¥Æ‡µç‡¥™‡µº ‡¥®‡µΩ‡¥ï‡µÅ‡¥ï">
            <button class="btn" onclick="loginUser()">LOGIN</button>
        </div>
    </div>

    <div id="mainView" style="display:none;">
        <div id="confBox" class="card" style="text-align:center;">
            <h3 style="color:var(--primary);">‡¥∏‡µç‡¥µ‡¥æ‡¥ó‡¥§‡¥Ç</h3>
            <div id="userDataShow" style="line-height:2; margin-bottom:15px;"></div>
            <div id="quizTimerDisplay" style="font-weight:bold; color:red; margin-bottom:15px;"></div>
            <button class="btn" id="startBtn" onclick="enterQuiz()">START QUIZ</button>
            <div id="certificateArea" style="margin-top:20px; display:none;">
                <p style="font-weight:bold;">‡¥§‡¥æ‡¥ô‡µç‡¥ï‡¥≥‡µÅ‡¥ü‡µÜ ‡¥∏‡µº‡¥ü‡µç‡¥ü‡¥ø‡¥´‡¥ø‡¥ï‡µç‡¥ï‡¥±‡µç‡¥±‡µç ‡¥§‡¥æ‡¥¥‡µÜ ‡¥ï‡¥æ‡¥£‡¥æ‡¥Ç</p>
                <canvas id="userCertCanvas" width="800" height="1000"></canvas>
                <button class="btn" style="background:#f1c40f; color:black; margin-top:10px;" onclick="downloadCert()">DOWNLOAD CERTIFICATE</button>
            </div>
        </div>
        <div id="quizArea" style="display:none;"></div>
    </div>
</div>

<div class="footer"><b>MUHSIN MANNANI | +91 7559950633</b></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = { apiKey: "AIzaSyCS9jqJEr_umK_goyXuf3njYCE_Cb8xU7o", authDomain: "skssf-quiz.firebaseapp.com", projectId: "skssf-quiz", storageBucket: "skssf-quiz.firebasestorage.app", messagingSenderId: "999161549501", appId: "1:999161549501:web:7be9c98c287b92881a5dd4" };
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let user = null;
let quizLive = false;

// ‡¥™‡µä‡¥§‡µÅ‡¥µ‡¥æ‡¥Ø‡¥ø ‡¥µ‡¥ø‡¥ú‡¥Ø‡¥ø‡¥ï‡¥≥‡µÜ ‡¥ï‡¥æ‡¥£‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡¥®‡µÅ‡¥≥‡µç‡¥≥ ‡¥´‡¥ô‡µç‡¥ï‡µç‡¥∑‡µª
db.collection("quiz_settings").doc("status").onSnapshot(async snap => {
    const d = snap.data();
    if(d.showPosters) {
        document.getElementById('publicWinnerArea').style.display = 'block';
        const winSnap = await db.collection("winners").doc("list").get();
        const winIds = winSnap.data().winnerIds || [];
        if(winIds.length > 0) {
            // ‡¥Ü‡¥¶‡µç‡¥Ø‡¥§‡µç‡¥§‡µÜ ‡¥µ‡¥ø‡¥ú‡¥Ø‡¥ø‡¥Ø‡µÅ‡¥ü‡µÜ ‡¥™‡µã‡¥∏‡µç‡¥±‡µç‡¥±‡µº ‡¥â‡¥¶‡¥æ‡¥π‡¥∞‡¥£‡¥Æ‡¥æ‡¥Ø‡¥ø ‡¥ï‡¥æ‡¥£‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ
            const firstWin = await db.collection("participants").doc(winIds[0]).get();
            drawPoster('publicCanvas', firstWin.data(), true);
        }
    }
});

async function registerUser() {
    const name = document.getElementById('rName').value.trim();
    const mob = document.getElementById('rMob').value.trim();
    const br = document.getElementById('rBranch').value;
    if(!name || mob.length < 10) return alert("‡¥µ‡¥ø‡¥µ‡¥∞‡¥ô‡µç‡¥ô‡µæ ‡¥®‡µΩ‡¥ï‡µÅ‡¥ï");
    const check = await db.collection("participants").where("mobile", "==", mob).get();
    if(!check.empty) return alert("‡¥à ‡¥®‡¥Æ‡µç‡¥™‡µº ‡¥®‡¥ø‡¥≤‡¥µ‡¥ø‡¥≤‡µÅ‡¥£‡µç‡¥ü‡µç");
    const snap = await db.collection("participants").get();
    let id = 1000 + snap.size + 1;
    await db.collection("participants").doc(id.toString()).set({ name, mobile: mob, branch: br, regId: id });
    document.getElementById('finalId').innerText = id;
    document.getElementById('regSuccess').style.display = 'block';
    document.getElementById('regForm').style.display = 'none';
}

async function loginUser() {
    const id = document.getElementById('lId').value.trim();
    const doc = await db.collection("participants").doc(id).get();
    if(!doc.exists) return alert("‡¥§‡µÜ‡¥±‡µç‡¥±‡¥æ‡¥Ø ‡¥ê‡¥°‡¥ø");
    user = doc.data();
    document.getElementById('authSec').style.display = 'none';
    document.getElementById('mainView').style.display = 'block';
    document.getElementById('userDataShow').innerHTML = `<b>${user.name}</b><br>${user.branch}`;

    db.collection("quiz_settings").doc("status").onSnapshot(async snap => {
        const d = snap.data();
        if(d.closed) {
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('certificateArea').style.display = 'block';
            const winDoc = await db.collection("winners").doc("list").get();
            const winIds = winDoc.data().winnerIds || [];
            drawPoster('userCertCanvas', user, winIds.includes(user.regId.toString()));
        }
    });
}

function drawPoster(canvasId, data, isWinner) {
    const cvs = document.getElementById(canvasId);
    const ctx = cvs.getContext('2d');
    cvs.style.display = 'block';
    
    // Background
    ctx.fillStyle = isWinner ? "#004d00" : "#f8f9fa"; ctx.fillRect(0,0,800,1000);
    ctx.strokeStyle = "#f1c40f"; ctx.lineWidth = 20; ctx.strokeRect(40,40,720,920);
    
    // Design Elements
    ctx.fillStyle = isWinner ? "white" : "#333"; ctx.textAlign = "center";
    ctx.font = "bold 50px Arial"; ctx.fillText("SAMASTHA ONLINE QUIZ", 400, 150);
    
    ctx.fillStyle = "#f1c40f"; ctx.font = "bold 70px Arial"; ctx.fillText(data.name.toUpperCase(), 400, 500);
    ctx.fillStyle = isWinner ? "white" : "#555"; ctx.font = "40px Arial"; ctx.fillText(data.branch, 400, 580);
    
    if(isWinner) {
        ctx.fillStyle = "#f1c40f"; ctx.beginPath(); ctx.arc(400, 800, 100, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = "#000"; ctx.font = "bold 40px Arial"; ctx.fillText("WINNER", 400, 815);
    } else {
        ctx.font = "italic 35px Arial"; ctx.fillText("Participation Certificate", 400, 800);
    }
}

function downloadCert() {
    const a = document.createElement('a'); a.download = 'Quiz_Cert.png';
    a.href = document.getElementById('userCertCanvas').toDataURL(); a.click();
}
</script>
</body>
</html>