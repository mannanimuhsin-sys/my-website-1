<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live Scoreboard</title>
<style>
body{font-family:sans-serif;background:#0f172a;color:#fff;margin:0;padding:0;}
.container{max-width:1000px;margin:auto;padding:20px;}
h2{text-align:center;margin-bottom:12px;}
select{width:100%;padding:12px;border-radius:10px;margin-bottom:20px;border:none;font-size:16px;}
.result-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:15px;}
.place-card{background: linear-gradient(145deg,#020617,#1e293b);border-radius:16px;padding:18px;text-align:center;box-shadow:0 15px 40px rgba(0,0,0,.5);}
.place-card h3{margin:0 0 10px 0;font-size:20px;}
.place-card .name{font-size:24px;font-weight:bold;margin:8px 0;}
.team-badge{display:inline-block;padding:6px 12px;border-radius:20px;background:#334155;margin-top:5px;}
.first{border-top:5px solid #facc15;color:#facc15;}
.second{border-top:5px solid #e5e7eb;color:#e5e7eb;}
.third{border-top:5px solid #fb923c;color:#fb923c;}
.score-board{margin-top:20px;}
.score-row{display:flex;justify-content:space-between;padding:14px;background:#020617;border-radius:12px;margin-bottom:8px;font-size:18px;}
.leader{border-left:6px solid #22c55e;}
.trailer{border-left:6px solid #ef4444;}
</style>
</head>
<body>
<div class="container">
<h2>üèÜ Live Scoreboard</h2>

<h2>üìÇ Category</h2>
<select id="category"></select>

<h2>üë¶üëß Section</h2>
<select id="section"></select>

<h2>üé§ Program</h2>
<select id="program"></select>

<h2>Results</h2>
<div id="result"></div>

<h2>Team Scores</h2>
<div id="teamScore"></div>
</div>

<script>
// Replace this with your published CSV link from Google Sheet
const SHEET_URL = "httphttps://docs.google.com/spreadsheets/d/e/2PACX-1vS5SWfyAIfTa2S1BMgSX28T5_upZvvRe25oJkIVx0Qo8mGMX9GGGS-z_t0sGZ19RTqPqAGZcHRHoXft/pub?gid=0&single=true&output=csvs://docs.google.com/spreadsheets/d/e/2PACX-1vSg2i8RcdUO8zRm8AxE5G3ZgVg9x/pub?output=csv";

let rows=[];

// Convert CSV to JS array
function csvToArray(str, delimiter = ",") {
    const lines = str.trim().split("\n");
    const headers = lines.shift().split(delimiter);
    return lines.map(l=>{
        const values = l.split(delimiter);
        let obj = {};
        headers.forEach((h,i)=>obj[h.trim()]=values[i].trim());
        return obj;
    });
}

// Fetch Google Sheet CSV
function fetchData(){
    fetch(SHEET_URL)
    .then(r=>r.text())
    .then(csv=>{
        rows = csvToArray(csv);
        init();
    }).catch(e=>console.error("Error fetching CSV:", e));
}

// Initialize Category dropdown
function init(){
    const catSel=document.getElementById("category");
    catSel.innerHTML="";
    [...new Set(rows.map(r=>r.Category))].forEach(c=>{
        catSel.innerHTML+=`<option>${c}</option>`;
    });
    catSel.onchange=loadSection;
    loadSection();
}

// Load Section dropdown
function loadSection(){
    const cat=document.getElementById("category").value;
    const secSel=document.getElementById("section");
    secSel.innerHTML="";
    [...new Set(rows.filter(r=>r.Category==cat).map(r=>r.Section))].forEach(s=>{
        secSel.innerHTML+=`<option>${s}</option>`;
    });
    secSel.onchange=loadProgram;
    loadProgram();
}

// Load Program dropdown
function loadProgram(){
    const cat=document.getElementById("category").value;
    const sec=document.getElementById("section").value;
    const progSel=document.getElementById("program");
    progSel.innerHTML="";
    [...new Set(rows.filter(r=>r.Category==cat && r.Section==sec).map(r=>r.Program))].forEach(p=>{
        progSel.innerHTML+=`<option>${p}</option>`;
    });
    progSel.onchange=showResult;
    showResult();
}

// Show result and team scores
function showResult(){
    const cat=document.getElementById("category").value;
    const sec=document.getElementById("section").value;
    const prog=document.getElementById("program").value;
    const resultDiv=document.getElementById("result");
    const teamScoreDiv=document.getElementById("teamScore");

    const list=rows.filter(r=>r.Category==cat && r.Section==sec && r.Program==prog);
    list.sort((a,b)=>parseInt(a.Position)-parseInt(b.Position));

    let html='<div class="result-grid">';
    let teamScore={};

    list.forEach(r=>{
        const pts=r.Position=="1"?10:r.Position=="2"?5:3;
        teamScore[r.Team]=(teamScore[r.Team]||0)+pts;
        const cls=r.Position=="1"?"first":r.Position=="2"?"second":"third";
        const medal=r.Position=="1"?"ü•á FIRST":r.Position=="2"?"ü•à SECOND":"ü•â THIRD";

        html+=`<div class="place-card ${cls}">
            <h3>${medal}</h3>
            <div class="name">${r.Name}</div>
            <div class="team-badge">Team ${r.Team}</div>
        </div>`;
    });
    html+='</div>';
    resultDiv.innerHTML=html;

    const sorted=Object.entries(teamScore).sort((a,b)=>b[1]-a[1]);
    let scoreHtml='<div class="score-board">';
    sorted.forEach((t,i)=>{
        scoreHtml+=`<div class="score-row ${i==0?"leader":"trailer"}">
            <span>Team ${t[0]}</span><strong>${t[1]} pts</strong>
        </div>`;
    });
    scoreHtml+='</div>';
    teamScoreDiv.innerHTML=scoreHtml;
}

// Fetch every 10 seconds
fetchData();
setInterval(fetchData,10000);
</script>
</body>
</html>