<!DOCTYPE html>
<html lang="ml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Result View</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #004d00; --accent: #ffcc00; --bg: #f4f7f6; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg); margin: 0; padding: 0; color: #333; }
        
        .header { background: var(--primary); padding: 40px 20px; text-align: center; color: white; border-bottom-left-radius: 30px; border-bottom-right-radius: 30px; }
        .header h1 { margin: 0; font-size: 22px; text-transform: uppercase; }
        .header p { margin: 5px 0 0; opacity: 0.9; font-size: 14px; }

        .search-container { max-width: 350px; margin: -30px auto 20px; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; }
        .search-container h3 { margin-bottom: 15px; font-size: 18px; }
        
        input { width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 10px; font-size: 16px; box-sizing: border-box; outline: none; transition: 0.3s; text-align: center; }
        input:focus { border-color: var(--primary); }
        
        .btn-search { width: 100%; background: var(--primary); color: white; border: none; padding: 12px; border-radius: 10px; margin-top: 15px; font-weight: bold; cursor: pointer; font-size: 16px; }

        .result-card { max-width: 90%; margin: 20px auto; background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.05); display: none; }
        .result-header { background: #f8f9fa; padding: 20px; border-bottom: 1px solid #eee; text-align: center; }
        .result-header h2 { margin: 0; color: var(--primary); font-size: 20px; }
        
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; padding: 15px; background: #fff; gap: 10px; }
        .info-item { padding: 10px; border-radius: 8px; background: #f9f9f9; text-align: center; }
        .info-item span { display: block; font-size: 12px; color: #777; }
        .info-item strong { font-size: 15px; color: var(--primary); }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: #eee; padding: 12px; font-size: 13px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid #eee; font-size: 14px; }
        .mark-val { font-weight: bold; text-align: right; }

        .status-box { padding: 15px; text-align: center; font-weight: bold; font-size: 18px; border-top: 1px solid #eee; }
        .pass { color: #27ae60; }
        .fail { color: #e74c3c; }

        .footer { text-align: center; padding: 20px; font-size: 12px; color: #888; }
    </style>
</head>
<body>

<div class="header">
    <h1 id="mName">Loading...</h1>
    <p id="mPlace">Location</p>
</div>

<div class="search-container">
    <h3>Check Result</h3>
    <input type="number" id="regNo" placeholder="Register Number">
    <button class="btn-search" onclick="searchResult()">GET RESULT</button>
</div>

<div id="resultArea" class="result-card">
    <div class="result-header">
        <h2 id="stName">Student Name</h2>
    </div>
    <div class="info-grid">
        <div class="info-item"><span>Reg No</span><strong id="stReg">-</strong></div>
        <div class="info-item"><span>Rank</span><strong id="stRank">-</strong></div>
        <div class="info-item"><span>Total Mark</span><strong id="stTotal">-</strong></div>
        <div class="info-item"><span>Attendance</span><strong id="stAtt">-</strong></div>
    </div>
    
    <table>
        <thead><tr><th>Subject</th><th style="text-align:right;">Mark</th></tr></thead>
        <tbody id="markList"></tbody>
    </table>
    
    <div id="stStatus" class="status-box"></div>
</div>

<div class="footer">
    <p>System Developed by <b>Muhsin Mannani</b></p>
    <div style="font-size: 20px; margin-top: 10px; color: #555;">
        <i class="fab fa-whatsapp"></i> &nbsp; <i class="fas fa-phone-alt"></i> &nbsp; <i class="fab fa-instagram"></i>
    </div>
    <p>Â© 2026 MANNANI DIGITAL SOLUTIONS</p>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

<script>
    const firebaseConfig = { 
        apiKey: "AIzaSyBriz_0zYwQOcwVgd3XTQ0l-0NKBNYaZXQ", 
        authDomain: "misbahul-uloom-madrasa-4830c.firebaseapp.app", 
        projectId: "misbahul-uloom-madrasa-4830c", 
        storageBucket: "misbahul-uloom-madrasa-4830c.firebasestorage.app", 
        appId: "1:370558703441:web:dc68dbdbd685c9d07ea570" 
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let mData = null;
    const urlParams = new URLSearchParams(window.location.search);
    const mid = urlParams.get('id');

    async function loadMadrasa() {
        if(!mid) return;
        const doc = await db.collection("madrasa_data").doc(mid).get();
        if(doc.exists) {
            mData = doc.data();
            document.getElementById('mName').innerText = mData.info.name;
            document.getElementById('mPlace').innerText = mData.info.place;
        }
    }
    loadMadrasa();

    function searchResult() {
        const reg = document.getElementById('regNo').value;
        if(!mData || !reg) return alert("Please enter Register Number");

        let found = null;
        for(let cls in mData.results) {
            if(mData.results[cls][reg]) {
                found = mData.results[cls][reg];
                found.name = mData.students[cls][reg];
                break;
            }
        }

        if(found) {
            document.getElementById('stName').innerText = found.name;
            document.getElementById('stReg').innerText = reg;
            document.getElementById('stRank').innerText = found.rank || "-";
            document.getElementById('stTotal').innerText = found.total;
            document.getElementById('stAtt').innerText = found.att || "-";
            
            let h = "";
            for(let sub in found.marks) {
                h += `<tr><td>${sub}</td><td class="mark-val">${found.marks[sub]}</td></tr>`;
            }
            document.getElementById('markList').innerHTML = h;
            
            const sts = document.getElementById('stStatus');
            sts.innerText = found.status;
            sts.className = "status-box " + (found.status === "Passed" ? "pass" : "fail");
            
            document.getElementById('resultArea').style.display = "block";
        } else alert("Result not found!");
    }
</script>
</body>
</html>