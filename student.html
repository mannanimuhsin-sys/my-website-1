<!DOCTYPE html>
<html lang="ml">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student ID Card System</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">

<style>
:root{--green:#0b5d1e;--orange:#f39c12}
body{margin:0;background:#e9ecef;font-family:Roboto}
.container{max-width:430px;margin:auto;padding:15px}
.card{background:#fff;border-radius:16px;padding:20px;box-shadow:0 10px 25px rgba(0,0,0,.15)}
.tabs{display:flex;margin-bottom:15px}
.tabs button{flex:1;padding:12px;border:none;font-weight:bold}
.tabs .active{background:var(--green);color:#fff}
input,select{width:100%;padding:12px;margin-top:8px;border-radius:8px;border:1px solid #ccc}
button{width:100%;padding:14px;margin-top:15px;border:none;border-radius:10px;background:var(--green);color:#fff;font-weight:bold;cursor:pointer}

/* ID CARD */
#idArea{display:none;text-align:center}
#idCard{
 width:360px;background:#fff;margin:auto;border-radius:18px;
 overflow:hidden;box-shadow:0 20px 45px rgba(0,0,0,.4);border:2px solid #ddd
}
.header{background:var(--green);color:#fff;padding:18px}
.header h1{margin:0;font-size:22px}
.header p{margin:4px 0 0;font-size:13px}
.ribbon{background:var(--orange);color:#fff;font-weight:900;width:80%;margin:-15px auto 10px;padding:6px;border-radius:20px}
.photoBox{width:150px;height:190px;margin:10px auto;border-radius:14px;overflow:hidden;border:4px solid #fff;box-shadow:0 8px 20px rgba(0,0,0,.2)}
.photoBox img{width:100%;height:100%;object-fit:cover}
.details{padding:15px;text-align:left;font-size:13px}
.row{display:flex;border-bottom:1px solid #eee;padding:6px 0}
.row span:first-child{width:90px;color:#666}
.row span:last-child{font-weight:bold}
.footer{display:flex;justify-content:space-between;align-items:center;padding:10px 15px 15px}
.footer img{width:80px}
.sign{
 text-align:center;
 font-size:11px;
}

#signImg{
 width:90px;
 height:auto;
 display:block;
 margin:0 auto -6px;
}

.sign div{
 border-top:2px solid #333;
 width:90px;
 margin:4px auto 0;
}
/* QR PREVIEW PAGE */
#qrPage{
 display:none;min-height:100vh;background:#f4f6f8;
 display:flex;align-items:center;justify-content:center
}
.qrCard{
 background:#fff;padding:25px;border-radius:18px;
 text-align:center;box-shadow:0 10px 30px rgba(0,0,0,.25)
}
.qrCard img{width:140px;height:180px;object-fit:cover;border-radius:12px}
.qrCard h2{margin:10px 0 5px}
.qrCard p{margin:0;font-weight:bold;color:#555}

/* Cropper */
#cropBox{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:999;align-items:center;justify-content:center}
#cropBox div{background:#fff;padding:15px;border-radius:14px;width:90%;max-width:350px}
</style>
</head>

<body>

<div class="container" id="panel">
 <div class="card">
  <div class="tabs">
   <button id="tReg" class="active" onclick="showTab('reg')">REGISTER</button>
   <button id="tLog" onclick="showTab('log')">LOGIN</button>
  </div>

  <div id="regTab">
   <input id="name" placeholder="Student Name">
   <input id="regno" placeholder="Register Number">
   <input id="classN" placeholder="Class">
   <input id="father" placeholder="Father Name">
   <input id="mentor" placeholder="Mentor Name">
   <input id="phone" placeholder="Phone Number">

   <select id="gender">
    <option value="">Select Gender</option>
    <option>Male</option>
    <option>Female</option>
    <option>General</option>
   </select>

   <select id="blood">
    <option value="">Select Blood Group</option>
    <option>A+</option><option>A-</option>
    <option>B+</option><option>B-</option>
    <option>O+</option><option>O-</option>
    <option>AB+</option><option>AB-</option>
   </select>

   <input type="date" id="dob">
   <input type="file" id="photoInp" accept="image/*">
   <button onclick="saveStudent()">SAVE & VIEW ID</button>
  </div>

  <div id="logTab" style="display:none">
   <input id="loginReg" placeholder="Enter Register Number">
   <button onclick="login()">VIEW ID</button>
  </div>
 </div>
</div>

<!-- ID CARD -->
<div id="idArea">
 <div id="idCard">
  <div class="header">
   <h1>MISBAHUL ULOOM</h1>
   <p>MADRASA PERUVANA</p>
  </div>
  <div class="ribbon">STUDENT IDENTITY CARD</div>

  <div class="photoBox"><img id="pImg"></div>

  <div class="details">
   <div class="row"><span>Name</span><span id="pName"></span></div>
   <div class="row"><span>Father</span><span id="pFather"></span></div>
   <div class="row"><span>Class</span><span id="pClass"></span></div>
   <div class="row"><span>Mentor</span><span id="pMentor"></span></div>
   <div class="row"><span>Gender</span><span id="pGender"></span></div>
   <div class="row"><span>Blood</span><span id="pBlood"></span></div>
   <div class="row"><span>Phone</span><span id="pPhone"></span></div>
   <div class="row"><span>DOB</span><span id="pDob"></span></div>
   <div class="row"><span>ID No</span><span id="pReg"></span></div>
  </div>

  <div class="footer">
  <img id="qr">

  <div class="sign">
    <img src="signature.png" id="signImg">
    <div></div>
    Sadar Muallim
  </div>
</div>

 <button onclick="downloadID()">DOWNLOAD ID</button>
 <button onclick="location.reload()" style="background:#555">GO BACK</button>
</div>

<div id="qrPage">
 <div class="qrCard">
  <img id="qrPhoto">
  <h2 id="qrName"></h2>
  <p id="qrClass"></p>
 </div>
</div>

<div id="cropBox">
 <div>
  <img id="cropImg" style="width:100%">
  <button onclick="applyCrop()">CROP & APPLY</button>
 </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

<script>
let cropper, photoData;

function showTab(t){
 regTab.style.display=t=="reg"?"block":"none";
 logTab.style.display=t=="log"?"block":"none";
 tReg.classList.toggle("active",t=="reg");
 tLog.classList.toggle("active",t=="log");
}

photoInp.onchange=e=>{
 const r=new FileReader();
 r.onload=()=>{
  cropImg.src=r.result;
  cropBox.style.display="flex";
  cropper=new Cropper(cropImg,{aspectRatio:3/4});
 };
 r.readAsDataURL(e.target.files[0]);
}
function applyCrop(){
 photoData=cropper.getCroppedCanvas().toDataURL("image/jpeg");
 cropBox.style.display="none";
}

function saveStudent(){
 const s={
  name:name.value,
  reg:regno.value,
  class:classN.value,
  father:father.value,
  mentor:mentor.value,
  phone:phone.value,
  gender:gender.value,
  blood:blood.value,
  dob:dob.value,
  photo:photoData
 };
 localStorage.setItem("STU_"+s.reg,JSON.stringify(s));
 renderID(s);
}

function login(){
 const d=localStorage.getItem("STU_"+loginReg.value);
 if(!d){alert("Student not found");return;}
 renderID(JSON.parse(d));
}

function renderID(s){
 pName.innerText=s.name;
 pFather.innerText=s.father;
 pClass.innerText=s.class;
 pMentor.innerText=s.mentor;
 pGender.innerText=s.gender;
 pBlood.innerText=s.blood;
 pPhone.innerText=s.phone;
 pDob.innerText=s.dob.split("-").reverse().join("-");
 pReg.innerText=s.reg;
 pImg.src=s.photo;

 const qrData=encodeURIComponent(JSON.stringify({
  name:s.name,
  class:s.class,
  photo:s.photo
 }));
 qr.src=`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${location.href.split("#")[0]}#QR=${qrData}`;

 panel.style.display="none";
 idArea.style.display="block";
}

function downloadID(){
 html2canvas(idCard,{scale:2,useCORS:true}).then(c=>{
  let a=document.createElement("a");
  a.href=c.toDataURL("image/png");
  a.download="STUDENT_ID.png";
  a.click();
 });
}

if(location.hash.startsWith("#QR=")){
 document.body.innerHTML="";
 qrPage.style.display="flex";
 const d=JSON.parse(decodeURIComponent(location.hash.replace("#QR=","")));
 qrPhoto.src=d.photo;
 qrName.innerText=d.name;
 qrClass.innerText="Class : "+d.class;
}
</script>

</body>
</html>