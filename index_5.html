<!DOCTYPE html>
<html lang="ml">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Misbahul Uloom Madrasa</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
body{ background:#f4f6f8; font-family:Arial,sans-serif; }
.jumbotron{
  background-image: linear-gradient(rgba(0,0,0,0.55), rgba(0,0,0,0.55)), url("madrasa.jpg");
  background-size:cover; background-position:center; background-repeat:no-repeat;
  color:white; margin-bottom:25px; padding:80px 10px;
}
.box{ background:white; padding:20px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.08); margin-bottom:20px; }
.exec-link{ display:block; margin-top:12px; padding:15px; border-radius:10px; background:linear-gradient(135deg,#198754,#20c997); color:#fff; text-decoration:none; }
.exec-link:hover{ text-decoration:none; color:#fff; opacity:0.95; }
.exec-link h4{ margin:0; font-size:16px; font-weight:600; }
.exec-link p{ margin:3px 0 0; font-size:13px; opacity:0.9; }
footer{ background:#2c3e50; color:#fff; margin-top:40px; padding:15px 0; text-align:center; font-size:14px; }
footer span{ color:#f1c40f; font-weight:600; }
@media(max-width:768px){ .jumbotron{ padding:45px 15px; } .jumbotron h1{ font-size:24px; } .jumbotron h2{ font-size:16px; } }

/* Blood Bank Styles */
#bloodBankForm{ margin-top:20px; }
#bloodBankList{ margin-top:20px; }
.blood-card{ border:1px solid #ddd; padding:12px; border-radius:8px; margin-bottom:10px; background:#f8f9fa; position:relative; transition:0.3s; }
.blood-card h5{ margin:0; font-weight:600; }
.blood-card p{ margin:2px 0; font-size:14px; }
#downloadCSV{ margin-top:10px; }
.consent-box{ border:1px solid #ddd; padding:12px; border-radius:8px; background:#fff3cd; color:#856404; margin-bottom:15px; }
.contact-icons{ position:absolute; top:12px; right:12px; }
.contact-icons a{ margin-left:8px; font-size:28px; color:#198754; text-decoration:none; transition:0.3s; }
.contact-icons a:hover{ color:#14532d; transform:scale(1.2); }
.filter-box{ margin-bottom:15px; }
.highlight{ background:#f8d7da !important; border-color:#dc3545 !important; }
</style>
</head>
<body>

<div class="jumbotron text-center">
<h1>MISBAHUL ULOOM MADRASA</h1>
<h2>PERUVANA</h2>
<p>Under, Samastha Kerala Islam Matha Vidyabhyasa Board (SKIMVB) Reg.No:4224</p>
</div>

<div class="container">
  <div class="row">
    <!-- Existing Sections -->
    <div class="col-sm-4">
      <div class="box">
        <h3>üìò ‡¥Æ‡¥¶‡µç‡¥±‡¥∏ ‡¥µ‡¥ø‡¥µ‡¥∞‡¥Ç</h3>
        <p>‡¥á‡¥§‡µç Misbahul Uloom Madrasa Peruvana ‡¥Ø‡µÅ‡¥ü‡µÜ ‡¥î‡¥¶‡µç‡¥Ø‡µã‡¥ó‡¥ø‡¥ï ‡¥µ‡µÜ‡¥¨‡µç ‡¥™‡µá‡¥ú‡¥æ‡¥£‡µç.</p>
        <button class="btn btn-primary btn-block" onclick="openDashboard()">üìä Dashboard</button>
        <a href="https://mannanimuhsin-sys.github.io/my-website/index_7.html" target="_blank" class="exec-link">
          <h4>üìã ‡¥ï‡µç‡¥≤‡¥æ‡¥∏‡µç ‡¥µ‡¥ø‡¥¶‡µç‡¥Ø‡¥æ‡µº‡¥§‡µç‡¥•‡¥ø ‡¥µ‡¥ø‡¥µ‡¥∞‡¥ô‡µç‡¥ô‡µæ</h4>
          <p>Class-wise student strength & details</p>
        </a>
      </div>
    </div>

    <div class="col-sm-4">
      <div class="box text-center">
        <h3>üìä ‡¥™‡¥∞‡µÄ‡¥ï‡µç‡¥∑ ‡¥´‡¥≤‡¥Ç</h3>
        <p>2026 ‡¥µ‡¥æ‡µº‡¥∑‡¥ø‡¥ï ‡¥™‡¥∞‡µÄ‡¥ï‡µç‡¥∑‡¥Ø‡µÅ‡¥ü‡µÜ ‡¥´‡¥≤‡¥ô‡µç‡¥ô‡µæ ‡¥á‡¥µ‡¥ø‡¥ü‡µÜ ‡¥™‡µç‡¥∞‡¥∏‡¥ø‡¥¶‡µç‡¥ß‡µÄ‡¥ï‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥Ç.</p>
        <p>üîî Result will be announced soon</p>
        <button class="btn btn-primary btn-block" onclick="openResult()">Result View</button>
      </div>
    </div>

    <div class="col-sm-4">
      <div class="box text-center">
        <h3>üìç Location View</h3>
        <p>Misbahul Uloom Madrasa Peruvana ‚Äì Map View</p>
        <button class="btn btn-primary btn-block" onclick="openLocation()">Location View</button>
      </div>
    </div>

    <!-- Blood Bank Section BELOW Location -->
    <div class="col-sm-12">
      <div class="box">
        <h3>ü©∏ Blood Bank ‚Äì Donor Add & View</h3>
        <div class="consent-box">
          <strong>Notification Consent:</strong>  
          Blood donors will be notified when their blood type is required.  
          By submitting this form, you agree to be contacted via call or WhatsApp regarding blood donation requests.
        </div>

        <form id="bloodBankForm">
          <input type="text" class="form-control" id="bbName" placeholder="Full Name" required><br>
          <input type="text" class="form-control" id="bbPhone" placeholder="Mobile Number" required><br>
          <input type="text" class="form-control" id="bbAddress" placeholder="Full Address" required><br>
          <select class="form-control" id="bbGroup" required>
            <option value="">Select Blood Group</option>
            <option>A+</option><option>A-</option>
            <option>B+</option><option>B-</option>
            <option>AB+</option><option>AB-</option>
            <option>O+</option><option>O-</option>
          </select><br>
          <div class="checkbox">
            <label><input type="checkbox" id="bbConsent" required> I agree to be notified when my blood type is needed.</label>
          </div><br>
          <button type="submit" class="btn btn-success btn-block">Add Donor</button>
        </form>

        <div class="filter-box">
          <label>Highlight Blood Type Needed:</label>
          <select class="form-control" id="highlightGroup">
            <option value="">Select Blood Type</option>
            <option>A+</option><option>A-</option>
            <option>B+</option><option>B-</option>
            <option>AB+</option><option>AB-</option>
            <option>O+</option><option>O-</option>
          </select>
        </div>

        <div id="bloodBankList"></div>
        <button class="btn btn-info" id="downloadCSV">Download CSV</button>
      </div>
    </div>

  </div>
</div>

<footer>
¬© 2026 | Designed & Developed by <span>Muhsin Mannani</span>
</footer>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* ===== RESULT SWITCH ===== */
let resultPublished = false;
function openResult(){
if(resultPublished){
  window.location.href="https://mannanimuhsin-sys.github.io/my-website/index_3.html"; return;
}
let overlay=document.createElement("div");
overlay.style.position="fixed";
overlay.style.top=0;
overlay.style.left=0;
overlay.style.width="100%";
overlay.style.height="100%";
overlay.style.background="rgba(0,0,0,0.6)";
overlay.style.display="flex";
overlay.style.alignItems="center";
overlay.style.justifyContent="center";
overlay.style.zIndex="9999";
overlay.innerHTML=`
<div style="background:#fff; padding:30px; border-radius:16px; max-width:360px; width:90%; text-align:center; box-shadow:0 10px 25px rgba(0,0,0,.3);">
<h3 style="color:#dc3545;">‡¥ï‡µç‡¥∑‡¥Æ‡¥ø‡¥ï‡µç‡¥ï‡¥£‡¥Ç</h3>
<p style="line-height:1.7;">
‡¥¶‡¥Ø‡¥µ‡¥æ‡¥Ø‡¥ø ‡¥ï‡¥æ‡¥§‡µç‡¥§‡¥ø‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ...<br>
‡¥®‡¥ø‡¥≤‡¥µ‡¥ø‡µΩ ‡¥±‡¥ø‡¥∏‡µΩ‡¥ü‡µç‡¥ü‡µç ‡¥™‡µç‡¥∞‡¥∏‡¥ø‡¥¶‡µç‡¥ß‡µÄ‡¥ï‡¥∞‡¥ø‡¥ö‡µç‡¥ö‡¥ø‡¥ü‡µç‡¥ü‡¥ø‡¥≤‡µç‡¥≤<br>
<b>‡¥™‡µç‡¥∞‡¥∏‡¥ø‡¥¶‡µç‡¥ß‡µÄ‡¥ï‡¥∞‡¥£ ‡¥§‡µÄ‡¥Ø‡¥§‡¥ø‡¥Ø‡µÅ‡¥Ç ‡¥∏‡¥Æ‡¥Ø‡¥µ‡µÅ‡¥Ç ‡¥™‡¥ø‡¥®‡µç‡¥®‡µÄ‡¥ü‡µç ‡¥Ö‡¥±‡¥ø‡¥Ø‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥Ç</b>
</p>
<button onclick="this.parentElement.parentElement.remove()" style="background:#198754; border:none; color:white; padding:10px 25px; border-radius:25px;">OK</button>
</div>`;
document.body.appendChild(overlay);
}
function openDashboard(){ window.location.href="https://mannanimuhsin-sys.github.io/my-website/index_6.html"; }
function openLocation(){ window.location.href="https://maps.app.goo.gl/SZLnKkTARKPHvsVR8?g_st=aw"; }

/* ===== Firebase Blood Bank ===== */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const form = document.getElementById("bloodBankForm");
const donorList = document.getElementById("bloodBankList");
const highlightSelect = document.getElementById("highlightGroup");

form.addEventListener("submit", e=>{
  e.preventDefault();
  const name = document.getElementById("bbName").value;
  const phone = document.getElementById("bbPhone").value;
  const address = document.getElementById("bbAddress").value;
  const group = document.getElementById("bbGroup").value;
  const consent = document.getElementById("bbConsent").checked;

  db.collection("donors").add({ name, phone, address, group, consent, time: Date.now() });

  form.reset();
  alert("Donor added! You will be notified when your blood type is required.");
});

highlightSelect.addEventListener("change", ()=>{
  const type = highlightSelect.value;
  renderDonors(type);
});

function renderDonors(highlightType=""){
  db.collection("donors").orderBy("time","desc").get().then(snapshot=>{
    donorList.innerHTML = "";
    snapshot.forEach(doc=>{
      const d = doc.data();
      const card = document.createElement("div");
      card.className = "blood-card";
      if(highlightType && d.group===highlightType) card.classList.add("highlight");
      card.innerHTML = `<h5>${d.name}</h5>
                        <p>Address: ${d.address}</p>
                        <p>Blood Group: ${d.group}</p>
                        <p>Consent: ${d.consent?"Yes":"No"}</p>`;
      const icons = document.createElement("div");
      icons.className="contact-icons";
      const callLink = document.createElement("a");
      callLink.href=`tel:${d.phone}`; callLink.title="Call"; callLink.innerHTML='<i class="fas fa-phone"></i>';
      const waLink = document.createElement("a");
      waLink.href=`https://wa.me/91${d.phone}`; waLink.target="_blank"; waLink.title="WhatsApp";
      waLink.innerHTML='<i class="fab fa-whatsapp"></i>';
      icons.appendChild(callLink); icons.appendChild(waLink);
      card.appendChild(icons);
      donorList.appendChild(card);
    });
  });
}

// Auto-render real-time
db.collection("donors").orderBy("time","desc").onSnapshot(snapshot=>{
  const type = highlightSelect.value;
  donorList.innerHTML = "";
  snapshot.forEach(doc=>{
    const d = doc.data();
    const card = document.createElement("div");
    card.className = "blood-card";
    if(type && d.group===type) card.classList.add("highlight");
    card.innerHTML = `<h5>${d.name}</h5>
                      <p>Address: ${d.address}</p>
                      <p>Blood Group: ${d.group}</p>
                      <p>Consent: ${d.consent?"Yes":"No"}</p>`;
    const icons = document.createElement("div");
    icons.className="contact-icons";
    const callLink = document.createElement("a");
    callLink.href=`tel:${d.phone}`; callLink.title="Call"; callLink.innerHTML='<i class="fas fa-phone"></i>';
    const waLink = document.createElement("a");
    waLink.href=`https://wa.me/91${d.phone}`; waLink.target="_blank"; waLink.title="WhatsApp";
    waLink.innerHTML='<i class="fab fa-whatsapp"></i>';
    icons.appendChild(callLink); icons.appendChild(waLink);
    card.appendChild(icons);
    donorList.appendChild(card);
  });
});

// CSV download
document.getElementById("downloadCSV").addEventListener("click", ()=>{
  db.collection("donors").get().then(snapshot=>{
    let csv="Name,Phone,Address,Blood Group,Consent\n";
    snapshot.forEach(d=>{
      const data = d.data();
      csv += `${data.name},${data.phone},${data.address},${data.group},${data.consent?"Yes":"No"}\n`;
    });
    const blob = new Blob([csv],{type:"text/csv"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href=url; a.download="blood_donors.csv"; a.click();
    URL.revokeObjectURL(url);
  });
});
</script>
</body>
</html>