<!DOCTYPE html>
<html lang="ml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Program Control</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 20px; }
        .card { background: white; padding: 25px; border-radius: 15px; max-width: 500px; margin: auto; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #333; margin-bottom: 25px; }
        .section { margin-bottom: 30px; border-top: 1px solid #eee; padding-top: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #555; }
        input, textarea { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; align-items: center; margin-bottom: 10px; }
        button { width: 100%; background: #007bff; color: white; padding: 15px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; transition: 0.3s; }
        button:hover { background: #0056b3; }
        .info { font-size: 12px; color: #888; text-align: center; margin-top: 10px; }
    </style>
</head>
<body>

<div class="card">
    <h2>പ്രോഗ്രാം കൺട്രോൾ</h2>

    <div class="section">
        <label>നോട്ടീസ് ബോർഡ് (Notice Board)</label>
        <input type="text" id="nTitle" placeholder="വിഷയം (ഉദാ: മൗലീദ് സദസ്സ്)">
        <textarea id="nText" rows="3" placeholder="വിശദവിവരങ്ങൾ..."></textarea>
        <p class="info">* ഹെഡിംഗ് ശൂന്യമാക്കിയാൽ നോട്ടീസ് ബോർഡ് മറഞ്ഞുനിൽക്കും.</p>
    </div>

    <div class="section">
        <label>സമയ ക്രമീകരണം</label>
        <div class="grid" style="background:#eee; padding:5px; border-radius:5px;">
            <small>നിസ്കാരം</small><small>Bank +/-</small><small>Iqamah</small>
        </div>
        <div id="prayerInputs"></div>
    </div>

    <button onclick="save()">വിവരങ്ങൾ സേവ് ചെയ്യുക</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
    apiKey: "AIzaSyBriz_0zYwQOcwVgd3XTQ0l-0NKBNYaZXQ",
    authDomain: "misbahul-uloom-madrasa-4830c.firebaseapp.com",
    projectId: "misbahul-uloom-madrasa-4830c"
});
const db = firebase.firestore();
const prayers = ["Fajr", "Dhuhr", "Asr", "Maghrib", "Isha"];
const ml = ["സുബ്ഹി", "ളുഹർ", "അസർ", "മഗ്‌രിബ്", "ഇശാ"];

// പഴയ ഡാറ്റ ലോഡ് ചെയ്യുന്നു
db.collection("settings").doc("prayer_master").get().then(doc => {
    const data = doc.data() || { tuning: {}, delays: {} };
    document.getElementById('nTitle').value = data.noticeTitle || "";
    document.getElementById('nText').value = data.noticeText || "";
    
    document.getElementById('prayerInputs').innerHTML = prayers.map((p, i) => `
        <div class="grid">
            <span>${ml[i]}</span>
            <input type="number" id="t_${p}" value="${data.tuning[p] || 0}">
            <input type="number" id="d_${p}" value="${data.delays[p] || 15}">
        </div>
    `).join('');
});

function save() {
    const tuning = {};
    const delays = {};
    prayers.forEach(p => {
        tuning[p] = parseInt(document.getElementById(`t_${p}`).value) || 0;
        delays[p] = parseInt(document.getElementById(`d_${p}`).value) || 0;
    });

    db.collection("settings").doc("prayer_master").set({
        noticeTitle: document.getElementById('nTitle').value,
        noticeText: document.getElementById('nText').value,
        tuning: tuning,
        delays: delays
    }).then(() => alert("വിജയകരമായി സേവ് ചെയ്തു!"));
}
</script>
</body>
</html>