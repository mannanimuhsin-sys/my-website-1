<!DOCTYPE html>
<html lang="ml">
<head>
    <meta charset="UTF-8">
    <title>Madrasa Admin - Location Master</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <style>
        body { font-family: 'Poppins', sans-serif; background: #f4f7f6; padding: 20px; }
        .container { max-width: 500px; margin: auto; background: white; padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .card { background: #f9f9f9; padding: 15px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #eee; }
        h3 { color: #198754; text-align: center; }
        .row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        input { width: 60px; padding: 8px; border-radius: 8px; border: 1px solid #ddd; text-align: center; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.3s; }
        .btn-loc { background: #007bff; color: white; }
        .btn-save { background: #198754; color: white; }
    </style>
</head>
<body>

<div class="container">
    <h3>Admin Dashboard</h3>

    <div class="card">
        <h4 style="margin-top:0;">1. ലൊക്കേഷൻ സെറ്റ് ചെയ്യുക</h4>
        <p style="font-size: 11px; color: #666;">നിങ്ങളുടെ നാട്ടിലെ ബാങ്ക് സമയം കൃത്യമാകാൻ താഴെ കാണുന്ന ബട്ടൺ അമർത്തുക.</p>
        <button class="btn btn-loc" onclick="detectLocation()">DETECT MY LOCATION</button>
        <p id="locStatus" style="font-size: 10px; text-align: center; margin-top: 8px; color: #007bff;"></p>
    </div>

    <div class="card">
        <h4>2. ഇക്കാമത്ത് മിനിറ്റുകൾ</h4>
        <div class="row"><span>സുബ്ഹി:</span><input type="number" id="m_Fajr"></div>
        <div class="row"><span>ളുഹർ:</span><input type="number" id="m_Dhuhr"></div>
        <div class="row"><span>അസർ:</span><input type="number" id="m_Asr"></div>
        <div class="row"><span>മഗ്‌രിബ്:</span><input type="number" id="m_Maghrib"></div>
        <div class="row"><span>ഇശാ:</span><input type="number" id="m_Isha"></div>
    </div>

    <button class="btn btn-save" onclick="saveAll()">UPDATE ALL SETTINGS</button>
</div>

<script>
firebase.initializeApp({
    apiKey: "AIzaSyBriz_0zYwQOcwVgd3XTQ0l-0NKBNYaZXQ",
    authDomain: "misbahul-uloom-madrasa-4830c.firebaseapp.com",
    projectId: "misbahul-uloom-madrasa-4830c"
});
const db = firebase.firestore();

// ലൊക്കേഷൻ കണ്ടെത്തുന്നു
function detectLocation() {
    const status = document.getElementById('locStatus');
    if (!navigator.geolocation) {
        status.innerText = "Browser supports geolocation but it's disabled.";
        return;
    }
    status.innerText = "അന്വേഷിക്കുന്നു...";
    navigator.geolocation.getCurrentPosition(async (pos) => {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;
        await db.collection("settings").doc("location_data").set({ lat, lng });
        status.innerText = "ലൊക്കേഷൻ അപ്‌ഡേറ്റ് ആയി: " + lat.toFixed(4) + ", " + lng.toFixed(4);
    }, () => { status.innerText = "ലൊക്കേഷൻ കണ്ടെത്താനായില്ല."; });
}

// ഡാറ്റ ലോഡ് ചെയ്യുന്നു
window.onload = async () => {
    const doc = await db.collection("settings").doc("prayer_master").get();
    if(doc.exists) {
        const d = doc.data().delays;
        document.getElementById('m_Fajr').value = d.Fajr;
        document.getElementById('m_Dhuhr').value = d.Dhuhr;
        document.getElementById('m_Asr').value = d.Asr;
        document.getElementById('m_Maghrib').value = d.Maghrib;
        document.getElementById('m_Isha').value = d.Isha;
    }
};

async function saveAll() {
    await db.collection("settings").doc("prayer_master").set({
        delays: {
            Fajr: parseInt(document.getElementById('m_Fajr').value),
            Dhuhr: parseInt(document.getElementById('m_Dhuhr').value),
            Asr: parseInt(document.getElementById('m_Asr').value),
            Maghrib: parseInt(document.getElementById('m_Maghrib').value),
            Isha: parseInt(document.getElementById('m_Isha').value)
        }
    });
    alert("വിജയകരമായി അപ്‌ഡേറ്റ് ചെയ്തു!");
}
</script>
</body>
</html>